<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}CloudAnywhere{% endblock %}</title>
  <style>
    :root{
      --bg:#0d1117; --card:#161b22; --line:#262c36; --acc:#3b82f6;
      color-scheme:dark;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      min-height:100vh; display:flex; flex-direction:column;
      background:var(--bg); color:#d1d5db; font-family:system-ui,sans-serif;
    }
    a{color:#9bb1ff; text-decoration:none} a:hover{color:#b5c6ff}
    .btn{background:transparent;border:1px solid var(--line);color:#d1d5db;padding:8px 14px;border-radius:8px;cursor:pointer;font-size:14px}
    .btn.primary{background:var(--acc);border:none;color:#fff}.btn:hover{opacity:.9}

    header{display:flex;justify-content:space-between;align-items:center;padding:12px 28px;border-bottom:1px solid var(--line)}
    .brand a{font-weight:700;color:#fff}

    /* Контейнер страницы:
       по умолчанию узкий (лендинг),
       страница может попросить .wide */
    main.wrap{flex:1 0 auto; width:100%; max-width:1040px; margin:0 auto; padding:32px 18px}
    main.wrap.wide{max-width:1320px}
    @media (min-width:1600px){ main.wrap.wide{max-width:1440px} }

    footer{border-top:1px solid var(--line); text-align:center; padding:12px; color:#778}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}
    .muted{color:#98a2b3}
    /* user menu */
    .userbox{position:relative;display:inline-block}
    .avatar{width:36px;height:36px;border-radius:50%;background:var(--card);border:1px solid var(--line);color:#9bb1ff;font-weight:700;cursor:pointer}
    .dropdown{position:absolute;right:0;top:44px;background:var(--card);border:1px solid var(--line);border-radius:12px;min-width:200px;padding:6px;display:none;z-index:50}
    .dropdown.open{display:block}
    .dropdown-item{display:block;padding:10px 12px;border-radius:8px;color:#ddd}
    .dropdown-item:hover{background:#1b2230}.dropdown-sep{height:1px;background:var(--line);margin:6px 0}
  </style>
</head>
<body>
  <header>
    <div class="brand"><a href="{% url 'home' %}">CloudAnywhere</a></div>
    <nav>
      {% if user.is_authenticated %}
        <div class="userbox">
          <button class="avatar" id="avatarBtn">{{ user.email|first|upper }}</button>
          <div class="dropdown" id="userMenu">
            <div class="dropdown-item muted">{{ user.email }}</div>
            <a class="dropdown-item" href="{% url 'files' %}">Мои файлы</a>
            <div class="dropdown-sep"></div>
            <form method="post" action="{% url 'account_logout' %}">{% csrf_token %}
              <button class="dropdown-item" type="submit">Выйти</button>
            </form>
          </div>
        </div>
      {% else %}
        <a class="btn" href="{% url 'account_login' %}">Вход</a>
        <a class="btn primary" href="{% url 'account_signup' %}">Регистрация</a>
      {% endif %}
    </nav>
  </header>

  <main class="wrap {% block main_mod %}{% endblock %}">
    {% if messages %}
  <div style="margin:0 0 12px;display:grid;gap:8px">
    {% for m in messages %}
      <div class="card"
           style="border-color:{% if m.tags == 'success' %}#234d2a{% else %}#503131{% endif %};
                  background:{% if m.tags == 'success' %}#122016{% else %}#241617{% endif %}">
        {{ m }}
      </div>
    {% endfor %}
  </div>
{% endif %}

    {% block content %}{% endblock %}
  </main>

  <footer>© CloudAnywhere. Мини-облако для людей, уставших от флешек.</footer>

  <script>
    document.addEventListener('click', e=>{
      const b=document.getElementById('avatarBtn'), m=document.getElementById('userMenu');
      if(!b||!m) return;
      if(e.target===b){ m.classList.toggle('open'); return; }
      if(!m.contains(e.target)) m.classList.remove('open');
    });
  </script>
</body>
</html>
